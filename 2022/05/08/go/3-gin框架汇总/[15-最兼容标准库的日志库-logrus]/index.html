<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="李健博">
  <meta name="keyword" content="hexo-theme">
  
    <link rel="shortcut icon" href="/css/images/logo.png">
  
  <title>
    
      [15-最兼容标准库的日志库-logrus] | Mr.Lee-李健博的博客
    
  </title>
  <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/css/plugins/gitment.css">

  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script>
  
    
<script src="/js/qrious.js"></script>

  
  
    
<script src="/js/gitment.js"></script>

  
  

  
<meta name="generator" content="Hexo 6.1.0"></head>
<div class="wechat-share">
  <img src="/css/images/logo.png" />
</div>

  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>Mr.Lee-李健博的博客</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">主页</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">标签</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">归档</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">关于我</a>
          
        </li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">主页</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">标签</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">归档</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">关于我</a>
            
          </li>
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2>[15-最兼容标准库的日志库-logrus]</h2>



  <p class="post-date">2022-05-08</p>
    <!-- 不蒜子统计 -->
    <span id="busuanzi_container_page_pv" style='display:none' class="">
        <i class="icon-smile icon"></i> 阅读数：<span id="busuanzi_value_page_pv"></span>次
    </span>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><h1 id="15-最兼容标准库的日志库-logrus"><a href="#15-最兼容标准库的日志库-logrus" class="headerlink" title="[15-最兼容标准库的日志库-logrus]"></a>[15-最兼容标准库的日志库-logrus]</h1><h2 id="一-logrus介绍"><a href="#一-logrus介绍" class="headerlink" title="一 logrus介绍"></a>一 logrus介绍</h2><h3 id="1-1-log标准库优缺点"><a href="#1-1-log标准库优缺点" class="headerlink" title="1.1 log标准库优缺点"></a>1.1 log标准库优缺点</h3><h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><blockquote>
<p>Go标准库的log日志库非常简单</p>
<p>可以便设置任何<code>io.Writer</code>作为日志输出位置</p>
</blockquote>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><blockquote>
<p>1 仅仅提供了print，panic和fatal三个函数，不支持info&#x2F;debug等多个级别</p>
<p>2 记录错误有Fatal和Panic；Fatal通过调用<code>os.Exit(1)</code>来结束程序；Panic在写入日志后抛出一个panic；缺少ERROR日志级别，在不抛出异常和退出程序的情况下记录日志</p>
<p>3 不支持多输出 － 同时支持标准输出，文件等</p>
<p>4 缺乏日志格式化的能力，例如：记录函数名和行号，格式化日期和时间格式等</p>
<p>5 可读性与结构化差，没有Json格式或有分隔符，不方便后续的日志采集、监控等</p>
<p>6 对于更精细的日志级别、日志文件分割，以及日志分发等，没有提供支持</p>
</blockquote>
<h3 id="1-2-Go中常用第三方日志库"><a href="#1-2-Go中常用第三方日志库" class="headerlink" title="1.2 Go中常用第三方日志库"></a>1.2 Go中常用第三方日志库</h3><p>在Go的世界，流行的日志框架有logrus、zap、zerolog等</p>
<h4 id="logrus"><a href="#logrus" class="headerlink" title="logrus"></a>logrus</h4><p>目前Github上star数量最多的日志库</p>
<p>项目地址: <a target="_blank" rel="noopener" href="https://github.com/sirupsen/logrus">https://github.com/sirupsen/logrus</a></p>
<p>Stars数量：20.3k</p>
<h4 id="zap"><a href="#zap" class="headerlink" title="zap"></a>zap</h4><p>是Uber推出的一个快速、结构化的分级日志库</p>
<p>项目地址:<a target="_blank" rel="noopener" href="https://github.com/uber-go/zap">https://github.com/uber-go/zap</a></p>
<p>官方文档：<a target="_blank" rel="noopener" href="https://pkg.go.dev/go.uber.org/zap">https://pkg.go.dev/go.uber.org/zap</a></p>
<p>Stars数量：20.3k</p>
<h4 id="zerolog"><a href="#zerolog" class="headerlink" title="zerolog"></a>zerolog</h4><p>它的 API 设计非常注重开发体验和性能。<code>zerolog</code>只专注于记录 JSON 格式的日志，号称 0 内存分配</p>
<p>项目地址:<a target="_blank" rel="noopener" href="https://github.com/rs/zerolog">https://github.com/rs/zerolog</a></p>
<p>Stars数量：6.2k</p>
<h2 id="二-logrus"><a href="#二-logrus" class="headerlink" title="二 logrus"></a>二 logrus</h2><h3 id="2-1-logrus特点"><a href="#2-1-logrus特点" class="headerlink" title="2.1 logrus特点"></a>2.1 logrus特点</h3><h4 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h4><ul>
<li>完全兼容Go标准库日志模块：logrus拥有六种日志级别：debug、info、warn、error、fatal和panic，这是golang标准库日志模块的API的超集。如果之前项目使用标准库日志模块，完全可以以最低的代价迁移到logrus上</li>
<li>可扩展的Hook机制：允许使用者通过hook的方式将日志分发到任意地方，如本地文件系统、标准输出、linfluxdb、logstash、elasticsearch或者mq等，或者通过hook定义日志内容和格式等</li>
<li>可选的日志输出格式：logrus内置了两种日志格式，JSONFormatter和TextFormatter，如果这两个格式不满足需求，可以自己动手实现接口Formatter，来定义自己的日志格式</li>
<li>Field机制：logrus鼓励通过Field机制进行精细化的、结构化的日志记录，而不是通过冗长的消息来记录日志</li>
<li>logrus是一个可插拔的、结构化的日志框架，很多开源项目，如docker，prometheus等，都是用了logrus来记录其日志</li>
</ul>
<h4 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h4><p>尽管 logrus有诸多优点，但是为了灵活性和可扩展性，官方也削减了很多实用的功能，例如：</p>
<ul>
<li>没有提供行号和文件名的支持</li>
<li>输出到本地文件系统没有提供日志分割功能</li>
<li>官方没有提供输出到ELK等日志处理中心的功能</li>
</ul>
<p>但是这些功能都可以通过自定义hook来实现</p>
<h3 id="2-2-logrus配置"><a href="#2-2-logrus配置" class="headerlink" title="2.2 logrus配置"></a>2.2 logrus配置</h3><h4 id="日志级别"><a href="#日志级别" class="headerlink" title="日志级别"></a>日志级别</h4><p>logrus有7个日志级别，依次是Trace –&gt; Debug –&gt; Info –&gt; Warning –&gt;Error –&gt; Fatal –&gt;Panic</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  只输出不低于当前级别是日志数据</span></span><br><span class="line">logrus.SetLevel(logrus.DebugLevel)</span><br></pre></td></tr></table></figure>

<h4 id="日志格式"><a href="#日志格式" class="headerlink" title="日志格式"></a>日志格式</h4><p>logrus内置了<code>JSONFormatter</code>和<code>TextFormatter</code>两种格式，也可以通过<code>Formatter</code>接口定义日志格式</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TextFormatter格式</span></span><br><span class="line">logrus.SetFormatter(&amp;logrus.TextFormatter&#123;</span><br><span class="line">   ForceColors:               <span class="literal">true</span>,</span><br><span class="line">   EnvironmentOverrideColors: <span class="literal">true</span>,</span><br><span class="line">   TimestampFormat:           <span class="string">&quot;2006-01-02 15:04:05&quot;</span>, <span class="comment">//时间格式</span></span><br><span class="line">   <span class="comment">// FullTimestamp:true,</span></span><br><span class="line">   <span class="comment">// DisableLevelTruncation:true,</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// JSONFormatter格式</span></span><br><span class="line">logrus.SetFormatter(&amp;logrus.JSONFormatter&#123;</span><br><span class="line">   PrettyPrint:     <span class="literal">false</span>,                 <span class="comment">//格式化</span></span><br><span class="line">   TimestampFormat: <span class="string">&quot;2006-01-02 15:04:05&quot;</span>, <span class="comment">//时间格式</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="输出文件"><a href="#输出文件" class="headerlink" title="输出文件"></a>输出文件</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> logfile, _ := os.OpenFile(<span class="string">&quot;./log.log&quot;</span>, os.O_CREATE|os.O_RDWR|os.O_APPEND, <span class="number">0644</span>)</span><br><span class="line"> logrus.SetOutput(logfile) <span class="comment">//默认为os.stderr</span></span><br><span class="line"><span class="comment">//logrus.SetOutput(io.MultiWriter(os.Stdout, logfile)) // 输出到多个位置</span></span><br></pre></td></tr></table></figure>

<h4 id="日志定位"><a href="#日志定位" class="headerlink" title="日志定位"></a>日志定位</h4><p>定位行号（如：<code>func=main.main file=&quot;./xxx.go:38&quot;</code>）</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logrus.SetReportCaller(<span class="literal">true</span>)</span><br></pre></td></tr></table></figure>

<h3 id="2-3-快速使用"><a href="#2-3-快速使用" class="headerlink" title="2.3 快速使用"></a>2.3 快速使用</h3><blockquote>
<p>go get github.com&#x2F;sirupsen&#x2F;logrus</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/sirupsen/logrus&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 1 日志级别为debug</span></span><br><span class="line">	logrus.SetLevel(logrus.DebugLevel)</span><br><span class="line">	<span class="comment">//2 日志格式为json格式</span></span><br><span class="line">	logrus.SetFormatter(&amp;logrus.JSONFormatter&#123;</span><br><span class="line">		TimestampFormat: <span class="string">&quot;2006-01-02 15:04:05&quot;</span>,</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="comment">// 日志格式为文本格式</span></span><br><span class="line">	<span class="comment">//logrus.SetFormatter(&amp;logrus.TextFormatter&#123;</span></span><br><span class="line">	<span class="comment">//	ForceColors:               true,</span></span><br><span class="line">	<span class="comment">//	EnvironmentOverrideColors: true,</span></span><br><span class="line">	<span class="comment">//	TimestampFormat:           &quot;2006-01-02 15:04:05&quot;, //时间格式</span></span><br><span class="line">	<span class="comment">//	FullTimestamp:true,  // 显示完整时间</span></span><br><span class="line">	<span class="comment">//	DisableLevelTruncation:true,</span></span><br><span class="line">	<span class="comment">//&#125;)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//3 输出文件为app.log</span></span><br><span class="line">	logfile, _ := os.OpenFile(<span class="string">&quot;./app.log&quot;</span>, os.O_CREATE|os.O_RDWR|os.O_APPEND, <span class="number">0644</span>)</span><br><span class="line">	<span class="comment">//logrus.SetOutput(io.MultiWriter(os.Stdout,logfile)) // 即写到控制台，又写到文件中</span></span><br><span class="line">	logrus.SetOutput(logfile) <span class="comment">// 只写到文件中</span></span><br><span class="line">	<span class="comment">//不写默认为os.stderr</span></span><br><span class="line">	<span class="comment">// 4 日志定位--显示打印日志文件和位置</span></span><br><span class="line">	logrus.SetReportCaller(<span class="literal">true</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	logrus.Infoln(<span class="string">&quot;info--日志数据&quot;</span>)</span><br><span class="line">	logrus.Debugln(<span class="string">&quot;debug--日志数据&quot;</span>)</span><br><span class="line">	logrus.Errorln(<span class="string">&quot;err--日志数据&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-两个自带formatter和自定义"><a href="#2-4-两个自带formatter和自定义" class="headerlink" title="2.4 两个自带formatter和自定义"></a>2.4 两个自带formatter和自定义</h3><h4 id="TextFormatter"><a href="#TextFormatter" class="headerlink" title="TextFormatter"></a>TextFormatter</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> TextFormatter <span class="keyword">struct</span> &#123;</span><br><span class="line">	DisableColors <span class="type">bool</span> <span class="comment">// 开启颜色显示</span></span><br><span class="line">	</span><br><span class="line">	DisableTimestamp <span class="type">bool</span> <span class="comment">// 开启时间显示</span></span><br><span class="line"></span><br><span class="line">	TimestampFormat <span class="type">string</span>	<span class="comment">// 自定义时间格式</span></span><br><span class="line"></span><br><span class="line">	QuoteEmptyFields <span class="type">bool</span>	<span class="comment">//空字段括在引号中</span></span><br><span class="line"></span><br><span class="line">	CallerPrettyfier <span class="function"><span class="keyword">func</span><span class="params">(*runtime.Frame)</span></span> (function <span class="type">string</span>, file <span class="type">string</span>) <span class="comment">//用于自定义方法名和文件名的输出</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="JsonFormatter"><a href="#JsonFormatter" class="headerlink" title="JsonFormatter"></a>JsonFormatter</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> JSONFormatter <span class="keyword">struct</span> &#123;</span><br><span class="line">	TimestampFormat <span class="type">string</span> <span class="comment">// 自定义时间格式</span></span><br><span class="line"></span><br><span class="line">	DisableTimestamp <span class="type">bool</span> <span class="comment">// 开启时间显示</span></span><br><span class="line"></span><br><span class="line">	CallerPrettyfier <span class="function"><span class="keyword">func</span><span class="params">(*runtime.Frame)</span></span> (function <span class="type">string</span>, file <span class="type">string</span>) <span class="comment">//用于自定义方法名和文件名的输出</span></span><br><span class="line"></span><br><span class="line">	PrettyPrint <span class="type">bool</span> <span class="comment">//将缩进所有json日志</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="自定义Formatter"><a href="#自定义Formatter" class="headerlink" title="自定义Formatter"></a>自定义Formatter</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//只需要实现该接口</span></span><br><span class="line"><span class="keyword">type</span> Formatter <span class="keyword">interface</span> &#123;</span><br><span class="line">	Format(*Entry) ([]<span class="type">byte</span>, <span class="type">error</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 其中entry参数</span></span><br><span class="line"><span class="keyword">type</span> Entry <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// Contains all the fields set by the user.</span></span><br><span class="line">	Data Fields</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// Time at which the log entry was created</span></span><br><span class="line">	Time time.Time</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Level the log entry was logged at: Trace, Debug, Info, Warn, Error, Fatal or Panic</span></span><br><span class="line">	Level Level</span><br><span class="line"></span><br><span class="line">	<span class="comment">//Calling method, with package name</span></span><br><span class="line">	Caller *runtime.Frame</span><br><span class="line"></span><br><span class="line">	<span class="comment">//Message passed to Trace, Debug, Info, Warn, Error, Fatal or Panic  </span></span><br><span class="line">	Message <span class="type">string</span> </span><br><span class="line">	</span><br><span class="line">	<span class="comment">//When formatter is called in entry.log(), a Buffer may be set to entry</span></span><br><span class="line">	Buffer *bytes.Buffer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-5-日志打印方法"><a href="#2-5-日志打印方法" class="headerlink" title="2.5 日志打印方法"></a>2.5 日志打印方法</h3><p><strong>FieldLogger接口：</strong> <code>FieldLogger</code>定义了所有日志打印的方法</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> FieldLogger <span class="keyword">interface</span> &#123;</span><br><span class="line">   WithField(key <span class="type">string</span>, value <span class="keyword">interface</span>&#123;&#125;) *Entry</span><br><span class="line">   WithFields(fields Fields) *Entry</span><br><span class="line">   WithError(err <span class="type">error</span>) *Entry</span><br><span class="line"></span><br><span class="line">   Debugf(format <span class="type">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">   Infof(format <span class="type">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">   Printf(format <span class="type">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">   Warnf(format <span class="type">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">   Warningf(format <span class="type">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">   Errorf(format <span class="type">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">   Fatalf(format <span class="type">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">   Panicf(format <span class="type">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line"></span><br><span class="line">   Debug(args ...<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">   Info(args ...<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">   Print(args ...<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">   Warn(args ...<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">   Warning(args ...<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">   Error(args ...<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">   Fatal(args ...<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">   Panic(args ...<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line"></span><br><span class="line">   Debugln(args ...<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">   Infoln(args ...<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">   Println(args ...<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">   Warnln(args ...<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">   Warningln(args ...<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">   Errorln(args ...<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">   Fatalln(args ...<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">   Panicln(args ...<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-6-logrus实例"><a href="#2-6-logrus实例" class="headerlink" title="2.6 logrus实例"></a>2.6 logrus实例</h3><h4 id="实例日志打印方式一"><a href="#实例日志打印方式一" class="headerlink" title="实例日志打印方式一"></a>实例日志打印方式一</h4><p><code>默认实例 (函数)</code>，即通过logrus包提供的函数(覆盖了<code>FieldLogger</code>接口的所有方法)，直接打印日志。但其实logrus包函数是调用了<code>logrus.Loger</code>默认实例。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 直接调用包函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   logrus.Infoln(<span class="string">&quot;info--日志&quot;</span>)</span><br><span class="line">   logrus.Errorln(<span class="string">&quot;err--日志&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="实例日志打印方式二"><a href="#实例日志打印方式二" class="headerlink" title="实例日志打印方式二"></a>实例日志打印方式二</h4><p><code>Logger实例(对象)</code>，它实现了<code>FieldLogger</code>接口。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">//var loger = logrus.New()</span></span><br><span class="line">	<span class="keyword">var</span> loger = logrus.StandardLogger() <span class="comment">// 看源码，本质就是logrus.New()</span></span><br><span class="line">	loger.Formatter = &amp;logrus.JSONFormatter&#123;TimestampFormat: <span class="string">&quot;2006-01-02 15:04:05&quot;</span>&#125;</span><br><span class="line">	loger.Infoln(<span class="string">&quot;info--日志&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="实例日志打印方式三"><a href="#实例日志打印方式三" class="headerlink" title="实例日志打印方式三"></a>实例日志打印方式三</h4><p><code>Entry示例(对象)</code>，它也实现了<code>FieldLogger</code>接口，是最终是日志打印入口。</p>
<ul>
<li>这里用到了<code>Field</code>机制，logrus鼓励通过<code>Field</code>机制进行精细化的、结构化的日志记录，而不是通过冗长的消息来记录日志。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	logrus.SetFormatter(&amp;logrus.JSONFormatter&#123;TimestampFormat: <span class="string">&quot;2006-01-02 15:04:05&quot;</span>&#125;)</span><br><span class="line">	<span class="comment">// Entry实例</span></span><br><span class="line">	entry := logrus.WithFields(logrus.Fields&#123;</span><br><span class="line">		<span class="string">&quot;global&quot;</span>: <span class="string">&quot;全局字段-每个日志都会输出&quot;</span>,</span><br><span class="line">	&#125;)</span><br><span class="line">	entry.WithFields(logrus.Fields&#123;<span class="string">&quot;module&quot;</span>: <span class="string">&quot;自定义字段--用户模块&quot;</span>&#125;).Info(<span class="string">&quot;info--日志&quot;</span>)</span><br><span class="line">	entry.WithFields(logrus.Fields&#123;<span class="string">&quot;module&quot;</span>: <span class="string">&quot;自定义字段--商品模块&quot;</span>&#125;).Error(<span class="string">&quot;Error--日志&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-7-HOOK机制"><a href="#2-7-HOOK机制" class="headerlink" title="2.7 HOOK机制"></a>2.7 HOOK机制</h3><ul>
<li>hook即钩子，拦截器。它为logrus提供了强大的功能扩展，如将日志分发到任意地方，如本地文件系统、<code>logstash</code>、<code>es</code>等，或者切割日志、定义日志内容和格式等。hook接口原型如下：</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Hook <span class="keyword">interface</span> &#123;</span><br><span class="line">   Levels() []Level   <span class="comment">//日志级别</span></span><br><span class="line">   Fire(*Entry) <span class="type">error</span> <span class="comment">//打印入口（Entry对象）</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Hook-实现日志切割功能"><a href="#Hook-实现日志切割功能" class="headerlink" title="Hook - 实现日志切割功能"></a>Hook - 实现日志切割功能</h4><blockquote>
<p>需要借助于第三方(日志轮转库)：github.com&#x2F;lestrrat-go&#x2F;file-rotatelogs<br>和：github.com&#x2F;rifflock&#x2F;lfshook</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/lestrrat-go/file-rotatelogs&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/rifflock/lfshook&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/sirupsen/logrus&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//  说明：按时间切割日志文件（2秒创建一个日志文件）</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 保存日志文件名为app_hook开头，2s切换一个日志文件，最多保留5份</span></span><br><span class="line">	hook := NewLfsHook(<span class="string">&quot;app_hook&quot;</span>, time.Second*<span class="number">2</span>, <span class="number">5</span>)</span><br><span class="line">	<span class="comment">// 加入钩子</span></span><br><span class="line">	logrus.AddHook(hook)</span><br><span class="line">	<span class="comment">// 先打印一句日志</span></span><br><span class="line">	logrus.Infoln(<span class="string">&quot;info---测试开始&quot;</span>)</span><br><span class="line">	<span class="comment">// 通过WithFields方式创建log，写入通用内容module</span></span><br><span class="line">	log := logrus.WithFields(logrus.Fields&#123;<span class="string">&quot;module&quot;</span>: <span class="string">&quot;用户模块&quot;</span>&#125;)</span><br><span class="line">	<span class="comment">// 每隔一秒，调用一次info，一次err，最终只保留5个日志文件</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">15</span>; i++ &#123;</span><br><span class="line">		log.Infoln(<span class="string">&quot;info---&gt;成功&quot;</span>, i)</span><br><span class="line">		time.Sleep(time.Second)</span><br><span class="line">		log.Errorln(<span class="string">&quot;err---&gt;成功&quot;</span>, i)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 日志钩子(日志拦截，并重定向)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewLfsHook</span><span class="params">(logName <span class="type">string</span>, rotationTime time.Duration, leastDay <span class="type">uint</span>)</span></span> logrus.Hook &#123;</span><br><span class="line">	writer, err := rotatelogs.New(</span><br><span class="line">		<span class="comment">// 1 日志文件名字</span></span><br><span class="line">		logName+<span class="string">&quot;.%Y%m%d%H%M%S&quot;</span>,</span><br><span class="line">		<span class="comment">// 2 日志周期(默认每86400秒/一天旋转一次)</span></span><br><span class="line">		rotatelogs.WithRotationTime(rotationTime),</span><br><span class="line">		<span class="comment">// 3 清除历史 (WithMaxAge和WithRotationCount只能选其一)</span></span><br><span class="line">		<span class="comment">//rotatelogs.WithMaxAge(time.Hour*24*7), //默认每7天清除下日志文件</span></span><br><span class="line">		rotatelogs.WithRotationCount(leastDay), <span class="comment">//只保留最近的N个日志文件</span></span><br><span class="line">	)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 可设置按不同level创建不同的文件名，咱们把6中日志都写到同一个writer中</span></span><br><span class="line">	lfsHook := lfshook.NewHook(lfshook.WriterMap&#123;</span><br><span class="line">		logrus.DebugLevel: writer,</span><br><span class="line">		logrus.InfoLevel:  writer,</span><br><span class="line">		logrus.WarnLevel:  writer,</span><br><span class="line">		logrus.ErrorLevel: writer,</span><br><span class="line">		logrus.FatalLevel: writer,</span><br><span class="line">		logrus.PanicLevel: writer,</span><br><span class="line">	&#125;, &amp;logrus.JSONFormatter&#123;TimestampFormat: <span class="string">&quot;2006-01-02 15:04:05&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> lfsHook</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Hook-写入Redis"><a href="#Hook-写入Redis" class="headerlink" title="Hook - 写入Redis"></a>Hook - 写入Redis</h4><p>将日志输出到redis</p>
<blockquote>
<p>需要借助于第三方模块：github.com&#x2F;rogierlommers&#x2F;logrus-redis-hook</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	logredis <span class="string">&quot;github.com/rogierlommers/logrus-redis-hook&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/sirupsen/logrus&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">	hookConfig := logredis.HookConfig&#123;</span><br><span class="line">		Host:     <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">		Key:      <span class="string">&quot;test&quot;</span>,</span><br><span class="line">		Format:   <span class="string">&quot;v1&quot;</span>,</span><br><span class="line">		App:      <span class="string">&quot;my_app_name&quot;</span>,</span><br><span class="line">		Port:     <span class="number">6379</span>,</span><br><span class="line">		Hostname: <span class="string">&quot;my_app_hostname&quot;</span>,</span><br><span class="line">		DB:       <span class="number">0</span>,</span><br><span class="line">		TTL:      <span class="number">3600</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	hook, err := logredis.NewHook(hookConfig)</span><br><span class="line">	<span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">		logrus.AddHook(hook)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		logrus.Errorf(<span class="string">&quot;日志写入redis配置出错: %q&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	logrus.WithFields(logrus.Fields&#123;<span class="string">&quot;module&quot;</span>: <span class="string">&quot;用户模块&quot;</span>&#125;).Info(<span class="string">&quot;info--日志--写入redis&quot;</span>)</span><br><span class="line">	logrus.WithFields(logrus.Fields&#123;<span class="string">&quot;module&quot;</span>: <span class="string">&quot;用户模块&quot;</span>&#125;).Error(<span class="string">&quot;Error--日志--写入redis&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试：</span></span><br><span class="line"><span class="comment">// 1.启动redis服务： redis-server</span></span><br><span class="line"><span class="comment">// 2.监控redis数据： redis-cli monitor</span></span><br></pre></td></tr></table></figure>

<h4 id="其他Hook"><a href="#其他Hook" class="headerlink" title="其他Hook"></a>其他Hook</h4><ul>
<li><code>MongoDb</code>：<a target="_blank" rel="noopener" href="https://github.com/weekface/mgorus">https://github.com/weekface/mgorus</a></li>
<li><code>Redis</code>：<a target="_blank" rel="noopener" href="https://github.com/rogierlommers/logrus-redis-hook">https://github.com/rogierlommers/logrus-redis-hook</a></li>
<li><code>InfluxDb</code>：<a target="_blank" rel="noopener" href="https://github.com/abramovic/logrus_influxdb">https://github.com/abramovic/logrus_influxdb</a></li>
<li><code>Logstash</code>：<a target="_blank" rel="noopener" href="https://github.com/bshuster-repo/logrus-logstash-hook">https://github.com/bshuster-repo/logrus-logstash-hook</a></li>
</ul>
<h3 id="2-8-Fatal处理"><a href="#2-8-Fatal处理" class="headerlink" title="2.8 Fatal处理"></a>2.8 Fatal处理</h3><p>logrus的<code>Fatal</code>输出，会执行<code>os.Exit(1)</code>。logrus提供<code>RegisterExitHandler</code>方法，可以在系统异常时调用一些资源释放api等，让应用正确地关闭。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	logrus.RegisterExitHandler(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;发生了fatal异常，执行关闭文件等工作&quot;</span>)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	logrus.Warnln(<span class="string">&quot;warn测试&quot;</span>)</span><br><span class="line">	logrus.Fatalln(<span class="string">&quot;fatal测试&quot;</span>)</span><br><span class="line">	logrus.Infoln(<span class="string">&quot;info测试&quot;</span>) <span class="comment">//不会执行</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三-Gin中集成"><a href="#三-Gin中集成" class="headerlink" title="三 Gin中集成"></a>三 Gin中集成</h2><ul>
<li>将gin框架的日志定向到logrus日志文件</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/sirupsen/logrus&quot;</span></span><br><span class="line">	<span class="string">&quot;io&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 日志输出格式</span></span><br><span class="line">	logrus.SetFormatter(&amp;logrus.JSONFormatter&#123;TimestampFormat: <span class="string">&quot;2006-01-02 15:04:05&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 日志输出路径</span></span><br><span class="line">	logfile, _ := os.OpenFile(<span class="string">&quot;./app.log&quot;</span>, os.O_CREATE|os.O_RDWR|os.O_APPEND, <span class="number">0644</span>)</span><br><span class="line">	logrus.SetOutput(io.MultiWriter(os.Stdout, logfile)) <span class="comment">// 日志写到控制台和文件中</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Gin日志重定向</span></span><br><span class="line">	gin.DisableConsoleColor()                              <span class="comment">//不需要颜色</span></span><br><span class="line">	<span class="comment">// gin的日志写到控制台和日志文件中</span></span><br><span class="line">	gin.DefaultWriter = io.MultiWriter(os.Stdout, logfile) <span class="comment">//默认是：os.Stdout</span></span><br><span class="line">	<span class="comment">//gin.DefaultWriter = logfile </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试：curl 0.0.0.0:8080/index</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	log := logrus.WithFields(logrus.Fields&#123;</span><br><span class="line">		<span class="string">&quot;module&quot;</span>: <span class="string">&quot;用户模块&quot;</span>,</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	r := gin.Default()</span><br><span class="line">	r.GET(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		log.Infoln(<span class="string">&quot;info---&gt;gin日志数据&quot;</span>)</span><br><span class="line">		c.String(<span class="number">200</span>, <span class="string">&quot;ok&quot;</span>)</span><br><span class="line">	&#125;)</span><br><span class="line">	r.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="四-logrus线程安全"><a href="#四-logrus线程安全" class="headerlink" title="四 logrus线程安全"></a>四 logrus线程安全</h2><ul>
<li>默认情况下，logrus的api都是线程安全的，其内部通过互斥锁来保护并发写。</li>
<li>互斥锁在调用hooks或者写日志的时候执行。</li>
<li>如果不需要锁，可以调用<code>logger.SetNoLock()</code>来关闭。</li>
</ul>
<p>可以关闭logrus互斥锁的情形：</p>
<ul>
<li>没有设置hook，或者所有的hook都是线程安全的实现。</li>
<li>写日志到logger.Out已经是线程安全的了。例如，logger.Out已经被锁保护，或者写文件时，文件是以O_APPEND方式打开的，并且每次写操作都小于4k。</li>
</ul>
</section>
    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#Go" >
    <span class="tag-code">Go</span>
  </a>

  <a href="/tags#Gin框架" >
    <span class="tag-code">Gin框架</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/2022/05/08/go/3-gin%E6%A1%86%E6%9E%B6%E6%B1%87%E6%80%BB/%5B17-%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86%E7%A5%9E%E5%99%A8-Viper%5D/">
        <span class="nav-arrow">← </span>
        
          [17-配置管理神器-Viper]
        
      </a>
    
    
      <a class="nav-right" href="/2022/05/08/go/3-gin%E6%A1%86%E6%9E%B6%E6%B1%87%E6%80%BB/%5B16-%E5%8F%B2%E4%B8%8A%E6%9C%80%E5%BF%AB%E7%9A%84%E6%97%A5%E5%BF%97%E5%BA%93-zap%5D/">
        
          [16-史上最快的日志库-zap]
        
        <span class="nav-arrow"> →</span>
      </a>
    
  </div>

    <!-- NAV END -->
    <!-- 打赏 START -->
    
      <div class="money-like">
        <div class="reward-btn">
          赏
          <span class="money-code">
            <span class="alipay-code">
              <div class="code-image"></div>
              <b>使用支付宝打赏</b>
            </span>
            <span class="wechat-code">
              <div class="code-image"></div>
              <b>使用微信打赏</b>
            </span>
          </span>
        </div>
        <p class="notice">点击上方按钮,请我喝杯咖啡！</p>
      </div>
    
    <!-- 打赏 END -->
    <!-- 二维码 START -->
    
      <div class="qrcode">
        <canvas id="share-qrcode"></canvas>
        <p class="notice">扫描二维码，分享此文章</p>
      </div>
    
    <!-- 二维码 END -->
    
      <!-- Gitment START -->
      <div id="comments"></div>
      <!-- Gitment END -->
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
  <!-- 不蒜子统计 -->
    <strong class="toc-title">目录</strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#15-%E6%9C%80%E5%85%BC%E5%AE%B9%E6%A0%87%E5%87%86%E5%BA%93%E7%9A%84%E6%97%A5%E5%BF%97%E5%BA%93-logrus"><span class="toc-nav-text">[15-最兼容标准库的日志库-logrus]</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E4%B8%80-logrus%E4%BB%8B%E7%BB%8D"><span class="toc-nav-text">一 logrus介绍</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-1-log%E6%A0%87%E5%87%86%E5%BA%93%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-nav-text">1.1 log标准库优缺点</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E4%BC%98%E7%82%B9"><span class="toc-nav-text">优点</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E7%BC%BA%E7%82%B9"><span class="toc-nav-text">缺点</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-2-Go%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E6%97%A5%E5%BF%97%E5%BA%93"><span class="toc-nav-text">1.2 Go中常用第三方日志库</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#logrus"><span class="toc-nav-text">logrus</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#zap"><span class="toc-nav-text">zap</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#zerolog"><span class="toc-nav-text">zerolog</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E4%BA%8C-logrus"><span class="toc-nav-text">二 logrus</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-1-logrus%E7%89%B9%E7%82%B9"><span class="toc-nav-text">2.1 logrus特点</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E4%BC%98%E7%82%B9-1"><span class="toc-nav-text">优点</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E7%BC%BA%E7%82%B9-1"><span class="toc-nav-text">缺点</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-2-logrus%E9%85%8D%E7%BD%AE"><span class="toc-nav-text">2.2 logrus配置</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E6%97%A5%E5%BF%97%E7%BA%A7%E5%88%AB"><span class="toc-nav-text">日志级别</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F"><span class="toc-nav-text">日志格式</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E8%BE%93%E5%87%BA%E6%96%87%E4%BB%B6"><span class="toc-nav-text">输出文件</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E6%97%A5%E5%BF%97%E5%AE%9A%E4%BD%8D"><span class="toc-nav-text">日志定位</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-3-%E5%BF%AB%E9%80%9F%E4%BD%BF%E7%94%A8"><span class="toc-nav-text">2.3 快速使用</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-4-%E4%B8%A4%E4%B8%AA%E8%87%AA%E5%B8%A6formatter%E5%92%8C%E8%87%AA%E5%AE%9A%E4%B9%89"><span class="toc-nav-text">2.4 两个自带formatter和自定义</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#TextFormatter"><span class="toc-nav-text">TextFormatter</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#JsonFormatter"><span class="toc-nav-text">JsonFormatter</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89Formatter"><span class="toc-nav-text">自定义Formatter</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-5-%E6%97%A5%E5%BF%97%E6%89%93%E5%8D%B0%E6%96%B9%E6%B3%95"><span class="toc-nav-text">2.5 日志打印方法</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-6-logrus%E5%AE%9E%E4%BE%8B"><span class="toc-nav-text">2.6 logrus实例</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E5%AE%9E%E4%BE%8B%E6%97%A5%E5%BF%97%E6%89%93%E5%8D%B0%E6%96%B9%E5%BC%8F%E4%B8%80"><span class="toc-nav-text">实例日志打印方式一</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E5%AE%9E%E4%BE%8B%E6%97%A5%E5%BF%97%E6%89%93%E5%8D%B0%E6%96%B9%E5%BC%8F%E4%BA%8C"><span class="toc-nav-text">实例日志打印方式二</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E5%AE%9E%E4%BE%8B%E6%97%A5%E5%BF%97%E6%89%93%E5%8D%B0%E6%96%B9%E5%BC%8F%E4%B8%89"><span class="toc-nav-text">实例日志打印方式三</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-7-HOOK%E6%9C%BA%E5%88%B6"><span class="toc-nav-text">2.7 HOOK机制</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#Hook-%E5%AE%9E%E7%8E%B0%E6%97%A5%E5%BF%97%E5%88%87%E5%89%B2%E5%8A%9F%E8%83%BD"><span class="toc-nav-text">Hook - 实现日志切割功能</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#Hook-%E5%86%99%E5%85%A5Redis"><span class="toc-nav-text">Hook - 写入Redis</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E5%85%B6%E4%BB%96Hook"><span class="toc-nav-text">其他Hook</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-8-Fatal%E5%A4%84%E7%90%86"><span class="toc-nav-text">2.8 Fatal处理</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E4%B8%89-Gin%E4%B8%AD%E9%9B%86%E6%88%90"><span class="toc-nav-text">三 Gin中集成</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E5%9B%9B-logrus%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8"><span class="toc-nav-text">四 logrus线程安全</span></a></li></ol></li></ol>
    
  </div>
</aside>
  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'https://mr-lee-alex.github.io/2022/05/08/go/3-gin框架汇总/[15-最兼容标准库的日志库-logrus]/';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

    // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', 'http://file.muyutech.com/error-img.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== 'http://file.muyutech.com/error-img.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })
  })();
</script>


  <script>
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });
  </script>



  <script>
    var gitmentConfig = "";
    if (gitmentConfig !== 'undefined') {
      var gitment = new Gitment({
        id: "[15-最兼容标准库的日志库-logrus]",
        owner: "",
        repo: "",
        oauth: {
          client_id: "",
          client_secret: ""
        },
        theme: {
          render(state, instance) {
            const container = document.createElement('div')
            container.lang = "en-US"
            container.className = 'gitment-container gitment-root-container'
            container.appendChild(instance.renderHeader(state, instance))
            container.appendChild(instance.renderEditor(state, instance))
            container.appendChild(instance.renderComments(state, instance))
            container.appendChild(instance.renderFooter(state, instance))
            return container;
          }
        }
      })
      gitment.render(document.getElementById('comments'))
    }
  </script>




    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
<!-- 不蒜子统计 -->
<span id="busuanzi_container_site_pv">
     本站总访问量<span id="busuanzi_value_site_pv"></span>次
</span>
<span class="post-meta-divider">|</span>
<span id="busuanzi_container_site_uv" style='display:none'>
     本站访客数<span id="busuanzi_value_site_uv"></span>人
</span>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



  <p class="copyright">
    &copy; 2022 | Proudly powered by <a href="https://www.cnblogs.com/m-r-lee" target="_blank">李健博的博客园</a>
    <br>
    Theme by <a target="_blank" rel="noopener" href="https://www.cnblogs.com/m-r-lee">李健博的博客园</a>
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>





<!-- Baidu Tongji -->


<script src="/js/script.js"></script>


<script src="/js/search.js"></script>


<script src="/js/load.js"></script>



  <span class="local-search local-search-google local-search-plugin" style="right: 50px;top: 70px;;position:absolute;z-index:2;">
      <input type="search" placeholder="站内搜索" id="local-search-input" class="local-search-input-cls" style="">
      <div id="local-search-result" class="local-search-result-cls"></div>
  </span>


  </body>
</html>